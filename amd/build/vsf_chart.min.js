/**
 * Progress Section Format
 *
 * @package    course/format
 * @subpackage vsf
 * @version    See the value of '$plugin->version' in version.php.
 * @copyright  2016 Gareth J Barnard
 * @author     G J Barnard - gjbarnard at gmail dot com and {@link http://moodle.org/user/profile.php?id=442195}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @license    Chartist is MIT licenced: https://raw.githubusercontent.com/gionkunz/chartist-js/master/LICENSE-MIT
 */
/* jshint ignore:start */
define(["jquery","format_vsf/chartist","core/log"],function(a,b,c){"use strict";// jshint ;_;
/**
     * Chartist.js plugin to pre fill donouts with animations.
     * author: moxx
     * author-url: https://github.com/moxx/chartist-plugin-fill-donut
     * @license    None specified.  Code is public.
     */
return c.debug("Progress Section Format Chartist AMD jQuery initialised"),function(a,b){var c={fillClass:"ct-fill-donut",label:{html:"div","class":"ct-fill-donut-label"},items:[{}]};b.plugins=b.plugins||{},b.plugins.fillDonut=function(d){return d=b.extend({},c,d),function(c){if(c instanceof b.Pie){var e=c.container;e.style.position="relative";var f,g=function(a){if("slice"===a.type){0===a.index&&(f=e.querySelector("svg"));var b=a.group._node.cloneNode(!0);d.fillClass.split(" ").forEach(function(a){b.setAttribute("class",b.getAttribute("class")+" "+a)}),[].forEach.call(b.querySelectorAll("path"),function(a){[].forEach.call(a.querySelectorAll("animate"),function(a){a.parentNode.removeChild(a)}),a.removeAttribute("stroke-dashoffset")}),f.insertBefore(b,f.childNodes[0])}};c.on("draw",function(a){g(a)}),c.on("created",function(f){var h=0;c.options.fillDonutOptions&&(d=b.extend({},d,c.options.fillDonutOptions),g(f)),[].forEach.call(d.items,function(c){var f=a.createElement(d.label.html);d.label["class"].split(" ").forEach(function(a){f.classList?f.classList.add(a):f.className+=" "+a});var g=b.extend({},{"class":"",id:"",content:"fillText",position:"center",//bottom, top, left, right
offsetY:0,//top, bottom in px
offsetX:0},c);g.id.length>0&&f.setAttribute("id",g.id),g["class"].length>0&&f.setAttribute("class",g["class"]),[].forEach.call(e.querySelectorAll('*[data-fill-index$="fdid-'+h+'"]'),function(a){a.parentNode.removeChild(a)}),f.setAttribute("data-fill-index","fdid-"+h),h+=1,f.insertAdjacentHTML("beforeend",g.content),f.style.position="absolute",e.appendChild(f);var i=Math.ceil(e.offsetWidth/2),j=Math.ceil(e.clientHeight/2),k=Math.ceil(f.offsetWidth/2),l=Math.ceil(f.clientHeight/2),m={bottom:{bottom:0+g.offsetY+"px",left:i-k+g.offsetX+"px"},top:{top:0+g.offsetY+"px",left:i-k+g.offsetX+"px"},left:{top:j-l+g.offsetY+"px",left:0+g.offsetX+"px"},right:{top:j-l+g.offsetY+"px",right:0+g.offsetX+"px"},center:{top:j-l+g.offsetY+"px",left:i-k+g.offsetX+"px"}};b.extend(f.style,m[g.position])})})}}}}(document,b),{init:function(d){function e(a,c){var d={donut:!0,donutWidth:10,startAngle:0,total:100,showLabel:!1,plugins:[
// https://github.com/moxx/chartist-plugin-fill-donut#license.
b.plugins.fillDonut({items:[{content:'<p class="vsf-percentage">'+a.chartdata.series[0]+"%</p>"}],label:{html:"div","class":"ct-fill-donut-label"}})]},e=new b.Pie(".vsf-chart-section-"+a.sectionno,a.chartdata,d);e.on("draw",function(a){if("slice"===a.type&&0==a.index){var b=a.element._node,c=b.getTotalLength();b.style.transition="none",b.style.WebkitTransition=b.style.transition,b.style.strokeDasharray=c+"px "+c+"px",b.style.strokeDashoffset=-c+"px",b.getBoundingClientRect(),b.style.transition="stroke-dashoffset 2s ease-out",b.style.WebkitTransition=b.style.transition,b.style.strokeDashoffset="0px"}})}c.debug("Progress Section Format Chartist AMD init initialised"),c.debug(d),a(document).ready(function(){d.forEach(e)})}}});